<?xml version='1.0' encoding='utf-8'?>
<project xmlns="http://www.plcopen.org/xml/tc6_0201" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:ns1="http://www.plcopen.org/xml/tc6_0201">
  <fileHeader companyName="Sconosciuto" productName="Senza_nome" productVersion="1" creationDateTime="2024-08-18T12:18:40"/>
  <contentHeader name="WEEE_PLCs" modificationDateTime="2024-08-23T23:35:08">
    <coordinateInfo>
      <fbd>
        <scaling x="10" y="10"/>
      </fbd>
      <ld>
        <scaling x="10" y="10"/>
      </ld>
      <sfc>
        <scaling x="10" y="10"/>
      </sfc>
    </coordinateInfo>
  </contentHeader>
  <types>
    <dataTypes>
      <dataType name="STATUSES">
        <baseType>
          <enum>
            <values>
              <value name="SHUT"/>
              <value name="OPEN"/>
              <value name="OK"/>
              <value name="DANGER"/>
            </values>
          </enum>
        </baseType>
      </dataType>
      <dataType name="FUNCTIONALITIES">
        <baseType>
          <enum>
            <values>
              <value name="CONTROLLER"/>
              <value name="SEPARATOR"/>
            </values>
          </enum>
        </baseType>
      </dataType>
      <dataType name="PLATFORM">
        <baseType>
          <struct>
            <variable name="ID">
              <type>
                <INT/>
              </type>
            </variable>
            <variable name="PC">
              <type>
                <REAL/>
              </type>
            </variable>
            <variable name="SETTING">
              <type>
                <derived name="SETTINGS"/>
              </type>
            </variable>
            <variable name="STATUS">
              <type>
                <derived name="STATUSES"/>
              </type>
            </variable>
            <variable name="DIRECTION">
              <type>
                <derived name="DIRECTIONS"/>
              </type>
            </variable>
            <variable name="WORKING_MATERIAL">
              <type>
                <derived name="MATERIALS"/>
              </type>
            </variable>
          </struct>
        </baseType>
      </dataType>
      <dataType name="SETTINGS">
        <baseType>
          <enum>
            <values>
              <value name="AUTOMATICO"/>
              <value name="MANUAL"/>
            </values>
          </enum>
        </baseType>
      </dataType>
      <dataType name="DIRECTIONS">
        <baseType>
          <enum>
            <values>
              <value name="FORWARD"/>
              <value name="BACKWARD"/>
            </values>
          </enum>
        </baseType>
      </dataType>
      <dataType name="WEIGHTS">
        <baseType>
          <enum>
            <values>
              <value name="H"/>
              <value name="M"/>
              <value name="L"/>
            </values>
          </enum>
        </baseType>
      </dataType>
      <dataType name="MATERIALS">
        <baseType>
          <enum>
            <values>
              <value name="STEEL"/>
              <value name="COPPER"/>
              <value name="GOLD"/>
              <value name="CLAY"/>
              <value name="STONE"/>
            </values>
          </enum>
        </baseType>
      </dataType>
    </dataTypes>
    <pous>
      <pou name="clensePlc" pouType="program">
        <interface>
          <localVars>
            <variable name="C_ID" address="%QW0">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="1"/>
              </initialValue>
            </variable>
            <variable name="C_PILOT_STATUS" address="%QW1">
              <type>
                <INT/>
              </type>
            </variable>
            <variable name="C_PILOT_FUNC" address="%QW2">
              <type>
                <INT/>
              </type>
            </variable>
            <variable name="C_PC_INT" address="%QW3">
              <type>
                <INT/>
              </type>
            </variable>
          </localVars>
          <localVars>
            <variable name="C_STATUS">
              <type>
                <derived name="STATUSES"/>
              </type>
              <initialValue>
                <simpleValue value="SHUT"/>
              </initialValue>
            </variable>
            <variable name="C_FUNC">
              <type>
                <derived name="FUNCTIONALITIES"/>
              </type>
              <initialValue>
                <simpleValue value="CONTROLLER"/>
              </initialValue>
            </variable>
            <variable name="C_PC_REAL">
              <type>
                <REAL/>
              </type>
              <initialValue>
                <simpleValue value="0.0"/>
              </initialValue>
            </variable>
            <variable name="WASTE_FB">
              <type>
                <derived name="PLATFORM_FB"/>
              </type>
            </variable>
            <variable name="C_WASTE">
              <type>
                <derived name="PLATFORM"/>
              </type>
            </variable>
            <variable name="C_WASTE_ID">
              <type>
                <INT/>
              </type>
              <initialValue>
                <simpleValue value="10"/>
              </initialValue>
              <documentation>
                <xhtml:p><![CDATA[plc id followed by 0 to 9 digit for each component]]></xhtml:p>
              </documentation>
            </variable>
            <variable name="C_WASTE_PC">
              <type>
                <REAL/>
              </type>
              <initialValue>
                <simpleValue value="0.0"/>
              </initialValue>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[(*Make the changes needed inside the function*)
WASTE_FB(
     WASTE_IN := C_WASTE,
     WASTE_OUT => C_WASTE);


(*CHANGE THE FUNCTIONALITY TO OK IN THE DRAWIO DIAGRAM!!!*)

(*Update the variables with the new ones*)
C_WASTE_PC := C_WASTE.PC;

(*Set C_STATUS based on remote input*)
CASE C_PILOT_STATUS OF
  0: C_STATUS := SHUT;
  1: C_STATUS := OPEN;
  2: C_STATUS := OK;
  3: C_STATUS := DANGER;
END_CASE;

(*logic for functionality status*)





CASE C_STATUS OF
        (*Imagine to read the power consuption of the PLC...*)
  SHUT: C_PC_REAL := 0.0;
        (*Need to cast the power consuption as an integer for the modbus to read it's value*)
        C_PC_INT := REAL_TO_INT(C_PC_REAL * 10.0);
  OPEN:  C_PC_REAL := C_PC_REAL + 0.7;
    
  
END_CASE;
]]></xhtml:p>
          </ST>
        </body>
      </pou>
      <pou name="densityPlc" pouType="program">
        <interface>
          <localVars>
            <variable name="D_RB23" address="%QX0.0">
              <type>
                <BOOL/>
              </type>
            </variable>
          </localVars>
          <localVars>
            <variable name="D_WASTE">
              <type>
                <derived name="PLATFORM"/>
              </type>
            </variable>
            <variable name="WASTE">
              <type>
                <derived name="PLATFORM_FB"/>
              </type>
            </variable>
          </localVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[D_RB23 := TRUE;


]]></xhtml:p>
          </ST>
        </body>
      </pou>
      <pou name="PLATFORM_FB" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="WASTE_IN">
              <type>
                <derived name="PLATFORM"/>
              </type>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="WASTE_OUT">
              <type>
                <derived name="PLATFORM"/>
              </type>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            <xhtml:p><![CDATA[(*The exact same logic applies for all platforms*)


(*Update the platform with new values*)
WASTE_OUT.ID := 1;
]]></xhtml:p>
          </ST>
        </body>
      </pou>
    </pous>
  </types>
  <instances>
    <configurations>
      <configuration name="Config0">
        <resource name="main_res">
          <task name="task0" priority="0" interval="T#20ms">
            <pouInstance name="instance0" typeName="clensePlc"/>
          </task>
        </resource>
      </configuration>
    </configurations>
  </instances>
</project>
